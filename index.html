<html lang = "en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=windows-1252">  
<title> NAICS code off zipcode</title>
<link rel="stylesheet" href="http://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap.css" >  
<style type = "text/css">


#Alex_table
{
@import "http://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap.css";
}
td {  

  opacity: .5;
  transition: opacity 420ms ease-in-out;
}
td:hover {
  opacity: 1;
}

#Alex_names
{
}    

#Alex_choices
{
@import "http://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap.css";
}
</style> 

</head>  
<body style= "background-color:black; color:white;">

<br />
<!-- to display insert box -->
<div class="container">     
  <h2>Zipcode</h2>  
  <form class="form-inline" role="form">  
    <form style="width:300px">  
  <div class="form-group">  
    <label ></label>  
    <input type = "text" class="form-control" id="search" placeholder="Zipcode">  
  </div>  
     
    <input type="button" class="btn btn-primary" id = "btn" onclick ="getZip(8);" value = "Go">  
	  </form> 
</form>
</div>

<div class="container"> 
<input type="button" class="btn btn-primary" id = "btn" onclick ="getZip(2);" value = "2 digit">
<input type="button" class="btn btn-primary" id = "btn" onclick ="getZip(4);" value = "4 digit">
<input type="button" class="btn btn-primary" id = "btn" onclick ="getZip(6);" value = "6 digit">
</div>


<br />
<br />


<!-- where the table to display desired codes are-->
<div class="container">  

<table class="table"  >  
<tr><th>NAICS CODE<br /></th><th>NAICS name<br /></th><th># of business <br /></th></tr>  
  <tr ><td id = "Alex_table"></td><td id = "Alex_names"></td><td id = "Alex_choices"></td></tr>   
</table>  
</div>    


<script src="//d3js.org/d3.v3.min.js" charset="utf-8"></script>
<script src="//d3js.org/topojson.v1.min.js"></script>
<script>



var properties = new Array();                          //global variables
var display_i =document.querySelector("#Alex_table");
var display_ii = document.querySelector("#Alex_choices");  
var display_iii = document.querySelector("#Alex_names");

function getZip(a) {
    var query = document.getElementById("search");
    var area = query.value;
    var query_string;
    query_string = "http://demeter.availabs.org:3000/API/geobyzip/" + area;
    console.log(query_string);



d3.json(query_string, function(error, zipcode) {
  if (error) return console.error(zipcode);

console.log(zipcode);
  
  var counter = 0;
  var zip = zipcode.data;
  var types = {};
  var sum = 0;
  for(i = 0; i < zip.length; i++) {

    var code = zip[i].NAICSCD;
    var name = zip[i].NAICSDS;

    if (types[code]) {
      types[code]++;
      sum++;
    } 
    else {
      types[code] = 1;
      types[name] = 1;  
      sum ++;
      counter++;  
    }
	  }
 
  console.log(counter);

  /*var _sum = Object.keys(types).reduce(function (sum, k) {
  
    var val = types[k]
  
    if (val) {
      sum += val
    }

    return sum
  }, 0) */

// using shadowDOM didnt work
  var cases =0;
  var items =  Object.keys(types);
  var businesses =Object.keys(types).map(function(key){return types[key]});
  var array_i = new Array() ;  //for refresing
  var array_ii = new Array()  ; 
  var array_iii = new Array()  ;

  //console.log(types);
    
  for(i = 0; i < counter; i++) {
      properties[i] = new Array();
      properties[i][0] = items[i] ;
      properties[i][1] =  items[counter+i];
      properties[i][2] =  businesses[i];
      }
      //display_i.innerHTML = array_i
  //console.log(properties);
  
  properties.sort(function(a,b) {

      return b[2] - a[2];
  });
  /* var bubble_sort = function(a,b,c,d) {
  d = 0;
  if (d = 1){
    bubble(
  }    
  for(i = 0; i < counter; i++) {
      if (i != 0) {
        if (properties[i][2] > properties[i-1][2]) {
          var temp = properties[i];
          properties[i] = properties[i-1];
          properties[i-1] = temp;
        }
      }    
  } */
    
  console.log(properties); 
    
  for(i = 0; i < counter; i++) {
  array_i += properties[i][0] + "<br />";
  if(properties[i][1] == null) {
    properties[i][1] = "OTHER BUSINESS";
  }
  array_iii += properties[i][1] + "<br />";
  array_ii += properties[i][2] + "<br />";
  }    
   
  display_i.innerHTML = array_i;
  display_iii.innerHTML= array_iii;
  display_ii.innerHTML= array_ii;

if (a == 2) {                     //choices
sort_by(2);
}

if (a == 4) {                     //choices
sort_by(4);
}

if (a == 6) {                     //choices
sort_by(6);
}

});

}
/* alex now needs you to make buttons for 2,4,6,8 digit NAICS code and have them descend */
console.log(properties);

function sort_by (a) {

  var two_prop = {};                           //if alex only wants values
  var two_display = properties;                //if alex wants new table
  var counter = 0;
  for(i = 0; i < two_display.length; i++) {
    if(a == 2) {
    two_display[i][0] = two_display[i][0].slice(0,2)
    }
    if(a == 4) {
    two_display[i][0] = two_display[i][0].slice(0,4)
    }
    if(a == 6) {
    two_display[i][0] = two_display[i][0].slice(0,6)
    }
    
  }
  

  two_display.sort(function(a,b) {

      return a[0] - b[0];
  });
  
  
  
  console.log(two_display);

  for(i = 0; i < properties.length; i++) {
   
    var total_count = properties[i][2];
    if(a == 2) {
    var code = properties[i][0].slice(0,2);
    }
    if(a == 4) {
    var code = properties[i][0].slice(0,4);
    }
    if(a == 6) {
    var code = properties[i][0].slice(0,6);
    }
    
    if (two_prop[code]) {
        two_prop[code]  += total_count;
    } 
    else {
        two_prop[code]  = total_count
        counter++;
    }
  }
    console.log(two_prop);
  
  var item =  Object.keys(two_prop);
  var business =Object.keys(two_prop).map(function(key){return two_prop[key]});
  var array_i = new Array() ;  //for refresing
  var array_ii = new Array();
  var array_iii = new Array();
  
  
  /*for(i = 0; i < counter; i++) {             //display options
    array_i += item[i] + "<br />";
    array_ii += business[i] + "<br />";
    array_iii += "<br />"
  }
  
  display_i.innerHTML = array_i;
  display_ii.innerHTML= array_ii;
  display_iii.innerHTML = ""; */
  
  array_i += two_display[0][0] + "<br />";
  array_ii += business[0] + "<br />";
  /*for(i = 0; i < counter; i++) {
    array_ii += business[i] + "<br />";
    
  
  }*/
  counter = 1;
  for(i = 0; i < two_display.length; i++) {
    if (i != 0) {
        if(two_display[i-1][0] != two_display[i][0]) {
            array_i += two_display[i][0] + "<br />";
            array_ii += business[counter] + "<br />";  
            counter++;                                        
        }
        else {
            array_i += "<br />"
            array_ii += "<br />"
        }
    }

    array_iii += two_display[i][1] +"<br />"
  }
  
  display_i.innerHTML = array_i;
  display_ii.innerHTML= array_ii;
  display_iii.innerHTML = array_iii;
  
  /*for(i = 0; i < two_display.length; i++) {
    array_i += two_display[i][0] + "<br />";
    array_iii += two_display[i][1] + "<br />";
    array_ii += two_display[i][2] + "<br />";
  
  }
  display_i.innerHTML += array_i;
  display_ii.innerHTML += array_ii;
  display_iii.innerHTML += array_iii; */   
  
  

};


</script>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.0/jquery.min.js"></script> 
 <script src="http://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/js/bootstrap.min.js"></script>
</body>
</html>    
    
    
    
    