<html lang = "en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=windows-1252">  
<title> NAICS code off zipcode</title>
<link rel="stylesheet" href="http://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap.css" >  
<style type = "text/css">


#Alex_table
{
@import "http://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap.css";
}
td {  

  opacity: 1;
  transition: opacity 420ms ease-in-out;
}
td:hover {
  opacity: .5;
}

#Alex_names
{
}    

#Alex_choices
{
@import "http://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap.css";
}
</style> 

</head>  
<body style= "background-color:black; color:white;">

<br />
<!-- to display insert box -->
<div class="container">     
  <h2>Zipcode</h2>  
  <form class="form-inline" role="form">  
    <form style="width:300px">  
  <div class="form-group">  
    <label ></label>  
    <input type = "text" class="form-control" id="search" placeholder="Zipcode">  
  </div>  
     
    <input type="button" class="btn btn-primary" id = "btn" onclick ="getZip();" value = "Go">  
	  </form> 
</form>
</div>


<!-- where the table to display desired codes are-->
<div class="container">  

<table class="table"  >  
<tr><th>NAICS CODE<br /></th><th>NAICS name<br /></th><th># of business <br /></th></tr>  
  <tr ><td id = "Alex_table"></td><td id = "Alex_names"></td><td id = "Alex_choices"></td></tr>   
</table>  
</div>    


<script src="//d3js.org/d3.v3.min.js" charset="utf-8"></script>
<script src="//d3js.org/topojson.v1.min.js"></script>
<script>



function getZip() {
    var query = document.getElementById("search");
    var area = query.value;
    var query_string;
    query_string = "http://demeter.availabs.org:3000/API/geobyzip/" + area;
    console.log(query_string);



d3.json(query_string, function(error, zipcode) {
  if (error) return console.error(zipcode);

console.log(zipcode);
  
  var counter = 0;
  var zip = zipcode.data;
  var types = {};
  	var sum = 0;
  for(i = 0; i < zip.length; i++) {

    var code = zip[i].NAICSCD;
    var name = zip[i].NAICSDS;

    if (types[code]) {
      types[code]++;
      sum++;
    } 
    else {
      types[code] = 1;
      types[name] = 1;  
      sum ++;
      counter++;  
    }
	  }
 
  console.log(sum);

  /*var _sum = Object.keys(types).reduce(function (sum, k) {
  
    var val = types[k]
  
    if (val) {
      sum += val
    }

    return sum
  }, 0) */

// using shadowDOM didnt work
  var cases =0;
  var display_i =document.querySelector("#Alex_table");
  var display_ii = document.querySelector("#Alex_choices");  
  var display_iii = document.querySelector("#Alex_names");
  var items =  Object.keys(types);
  var businesses =Object.keys(types).map(function(key){return types[key]});
  var array_i = new Array() ;  //for refresing
  var array_ii = new Array()  ; 
  var array_iii = new Array()  ;
  var properties = new Array(); 
  //console.log(types);
    
  for(i = 1; i < counter; i++) {
      array_i[i] = items[i];

      }
      //display_i.innerHTML = array_i
  for(i = 0; i < counter; i++) {
      array_ii[i] =  businesses[i];
      
      }
      //display_ii.innerHTML = array_ii;
    
  for(i = 0; i < counter; i++) {
      array_iii[i] =  items[counter+i];
      
      }
      //display_iii.innerHTML = array_iii;
   
   var sort_data = { 
        properties : { NAICSCD: array_i,
                       NAICSDS: array_iii,
                       counts: array_ii,
                     }
    }    
  console.log(sort_data.properties); 

console.log( document.styleSheets[0]); 
  
});

}


</script>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.0/jquery.min.js"></script> 
 <script src="http://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/js/bootstrap.min.js"></script>
</body>
</html>    
    
    
    
    